<html lang="en">
    <head>
        <title>Tables</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="styles.css">
        
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script type="text/javascript" src="http://acessa.loc/connect/plugins/handlebars-v4.0.4.js"></script>
    </head>
    <body>
        <script id="data-tpl" type="text/x-handlebars-template">
            <div id="av-matrix">
                <table>
                    <tr>
                        {{#each weeks}}
                            <td>thu<br>07</td>
                            <td class="weekend">fri<br>08</td>
                            <td class="weekend">sat<br>09</td>
                            <td>sun<br>10</td>
                            <td>mon<br>11</td>
                            <td>tue<br>12</td>
                            <td>wed<br>13</td>
                        {{/each}}
                    </tr>
                </table>
                <div>
                    {{#each roomTypes}}
                        <table>
                            <tr>
                                {{#each ../weeks}}
                                    <td class="modified"><a href="#">1</a></td>
                                    <td class="weekend"><a href="#">1</a></td>
                                    <td class="weekend"><a href="#">1</a></td>
                                    <td><a href="#">1</a></td>
                                    <td><a href="#">1</a></td>
                                    <td><a href="#">1</a></td>
                                    <td><a href="#">1</a></td>
                                {{/each}}
                            </tr>
                            <tr>
                                {{#each ../weeks}}
                                    <td>1</td>
                                    <td class="weekend">1</td>
                                    <td class="weekend">1</td>
                                    <td>1</td>
                                    <td>1</td>
                                    <td>1</td>
                                    <td>1</td>
                                {{/each}}
                            </tr>
                            <tr>
                                {{#each ../weeks}}
                                    <td><a href="#">0,00 &#8372;</a></td>
                                    <td class="weekend"><a href="#">0,00 &#8372;</a></td>
                                    <td class="weekend"><a href="#">0,00 &#8372;</a></td>
                                    <td><a href="#">0,00 &#8372;</a></td>
                                    <td><a href="#">0,00 &#8372;</a></td>
                                    <td><a href="#">0,00 &#8372;</a></td>
                                    <td><a href="#">0,00 &#8372;</a></td>
                                {{/each}}
                            </tr>
                            <tr>
                                {{#each ../weeks}}
                                    <td><a href="#">0</a></td>
                                    <td class="weekend"><a href="#">0</a></td>
                                    <td class="weekend"><a href="#">0</a></td>
                                    <td><a href="#">0</a></td>
                                    <td><a href="#">0</a></td>
                                    <td><a href="#">0</a></td>
                                    <td><a href="#">0</a></td>
                                {{/each}}
                            </tr>
                            <tr>
                                {{#each ../weeks}}
                                    <td><a href="#">0</a></td>
                                    <td class="weekend"><a href="#">0</a></td>
                                    <td class="weekend"><a href="#">0</a></td>
                                    <td><a href="#">0</a></td>
                                    <td><a href="#">0</a></td>
                                    <td><a href="#">0</a></td>
                                    <td><a href="#">0</a></td>
                                {{/each}}
                            </tr>
                            <tr>
                                {{#each ../weeks}}
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c1"><label for="ch-{{../roomId}}-{{this}}-c1"></label></td>
                                    <td class="weekend"><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c2"><label for="ch-{{../roomId}}-{{this}}-c2"></label></td>
                                    <td class="weekend"><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c3"><label for="ch-{{../roomId}}-{{this}}-c3"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c4"><label for="ch-{{../roomId}}-{{this}}-c4"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c5"><label for="ch-{{../roomId}}-{{this}}-c5"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c6"><label for="ch-{{../roomId}}-{{this}}-c6"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c7"><label for="ch-{{../roomId}}-{{this}}-c7"></label></td>
                                {{/each}}
                            </tr>
                            <tr>
                                {{#each ../weeks}}
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c8"><label for="ch-{{../roomId}}-{{this}}-c8"></label></td>
                                    <td class="weekend"><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c9"><label for="ch-{{../roomId}}-{{this}}-c9"></label></td>
                                    <td class="weekend"><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c10"><label for="ch-{{../roomId}}-{{this}}-c10"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c11"><label for="ch-{{../roomId}}-{{this}}-c11"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c12"><label for="ch-{{../roomId}}-{{this}}-c12"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c13"><label for="ch-{{../roomId}}-{{this}}-c13"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c14"><label for="ch-{{../roomId}}-{{this}}-c14"></label></td>
                                {{/each}}
                            </tr>
                            <tr>
                                {{#each ../weeks}}
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c15"><label for="ch-{{../roomId}}-{{this}}-c15"></label></td>
                                    <td class="weekend"><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c16"><label for="ch-{{../roomId}}-{{this}}-c16"></label></td>
                                    <td class="weekend"><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c17"><label for="ch-{{../roomId}}-{{this}}-c17"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c18"><label for="ch-{{../roomId}}-{{this}}-c18"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c19"><label for="ch-{{../roomId}}-{{this}}-c19"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c20"><label for="ch-{{../roomId}}-{{this}}-c20"></label></td>
                                    <td><input type="checkbox" id="ch-{{../roomId}}-{{this}}-c21"><label for="ch-{{../roomId}}-{{this}}-c21"></label></td>
                                {{/each}}
                            </tr>
                        </table>
                    {{/each}}
                </div>
            </div>
        </script>
        
        <script>
            Handlebars.registerHelper({
            'for': function(from, to, incr, block) {
                var accum = '';
                from = +from;
                to = +to;
                incr = +incr;

                for(var i = from; i < to; i += incr)
                    accum += block.fn(i);
                return accum;
                }
            });

             function getHandlebarsTplsAndRegister($el){
                if (!Handlebars) return false;

                $el = $el || $('[type="text/x-handlebars-template"]');
                var tpls = {};

                $el.each(function(i, val){
                    var $_tpl = $(val),
                        id = $_tpl.attr('id');

                    if (id) {
                        var name = id.replace(/-/g, '_');
                        if (!tpls[name]) {
                            tpls[name] = $_tpl[0].innerHTML;
                            Handlebars.registerPartial(name, tpls[name]);
                        }
                    }
                });

                return tpls;
            }
            
             $( window ).load(function(){
             //$(function(){
                console.time('Prepare HTML');
                var i;
                var hTpls = getHandlebarsTplsAndRegister($('#data-tpl'));
                var tpls = {};
                tpls.dataTpl = Handlebars.compile(hTpls.data_tpl);
                
                var roomTypes = [],
                    roomNumber = 120,
                    weeksNumber = 60,
                    weeks = [];
                    
                for (i=0;i<roomNumber;i++)
                    roomTypes.push({roomName:'room '+i, roomId:i});
                
                for (i=0;i<weeksNumber;i++)
                    weeks.push({a:1});
                
                console.timeEnd('Prepare HTML');
                
                console.time('Inserting HTML');
                $('#main-container')[0].innerHTML = tpls.dataTpl({roomTypes: roomTypes, weeks: weeks});
                console.timeEnd('Inserting HTML');
                
            })
        </script>
        <div id="main-container"></div>
    </body>
</html>